--- origsrc/qt-x11-opensource-src-4.4.3/projects.pro	2008-09-27 03:58:43.000000000 -0500
+++ src/qt-x11-opensource-src-4.4.3/projects.pro	2009-03-23 21:39:31.562500000 -0500
@@ -113,7 +113,7 @@ INSTALLS += translations
 
 #qmake
 qmake.path=$$[QT_INSTALL_BINS]
-win32 {
+win32|cygwin-g++ {
    qmake.files=$$QT_BUILD_TREE/bin/qmake.exe
 } else {
    qmake.files=$$QT_BUILD_TREE/bin/qmake
--- origsrc/qt-x11-opensource-src-4.4.3/qmake/generators/unix/unixmake.cpp	2009-03-22 14:23:33.687500000 -0500
+++ src/qt-x11-opensource-src-4.4.3/qmake/generators/unix/unixmake.cpp	2009-03-23 12:28:28.265625000 -0500
@@ -677,6 +677,8 @@ UnixMakefileGenerator::defaultInstall(co
         bundle = true;
     } else if(project->first("TEMPLATE") == "app") {
         target = "$(QMAKE_TARGET)";
+        if(!project->isEmpty("QMAKE_CYGWIN_EXE") && !target.endsWith(".exe"))
+            target += ".exe";
     } else if(project->first("TEMPLATE") == "lib") {
             if(!project->isActiveConfig("staticlib") && !project->isActiveConfig("plugin")) {
                 if(project->isEmpty("QMAKE_HPUX_SHLIB") && project->isEmpty("QMAKE_CYGWIN_SHLIB")) {
@@ -1054,8 +1054,12 @@
 MakefileGenerator::prlFileName(bool fixify)
 {
     QString ret = project->first("TARGET_PRL");;
-    if(ret.isEmpty())
-        ret = project->first("TARGET");
+    if(ret.isEmpty()) {
+        if (!project->isEmpty("QMAKE_CYGWIN_SHLIB"))
+            ret = project->first("L_TARGET");
+        else
+            ret = project->first("TARGET");
+    }
     int slsh = ret.lastIndexOf(Option::dir_sep);
     if(slsh != -1)
         ret = ret.right(ret.length() - slsh);
--- origsrc/qt-x11-opensource-src-4.4.0/qmake/generators/unix/unixmake.cpp	2008-04-28 08:11:14.000000000 -0500
+++ src/qt-x11-opensource-src-4.4.0/qmake/generators/unix/unixmake.cpp	2008-07-13 14:15:37.109375000 -0500
@@ -681,15 +681,13 @@
     } else if(project->first("TEMPLATE") == "app") {
         target = "$(QMAKE_TARGET)";
     } else if(project->first("TEMPLATE") == "lib") {
-        if(project->isEmpty("QMAKE_CYGWIN_SHLIB")) {
             if(!project->isActiveConfig("staticlib") && !project->isActiveConfig("plugin")) {
-                if(project->isEmpty("QMAKE_HPUX_SHLIB")) {
+                if(project->isEmpty("QMAKE_HPUX_SHLIB") && project->isEmpty("QMAKE_CYGWIN_SHLIB")) {
                     links << "$(TARGET0)" << "$(TARGET1)" << "$(TARGET2)";
                 } else {
                     links << "$(TARGET0)";
                 }
             }
-        }
     }
     for(int i = 0; i < targets.size(); ++i) {
         QString src = targets.at(i),
@@ -779,7 +777,10 @@
                     if(lslash != -1)
                         link = link.right(link.length() - (lslash + 1));
                     QString dst_link = filePrefixRoot(root, fileFixify(targetdir + link, FileFixifyAbsolute));
-                    ret += "\n\t-$(SYMLINK) \"$(TARGET)\" \"" + dst_link + "\"";
+                    if(!project->isEmpty("QMAKE_CYGWIN_SHLIB"))
+                        ret += "\n\t-$(INSTALL_FILE) \"" + destdir + "$(TARGET0)\" \"" + dst_link + "\"";
+                    else
+                        ret += "\n\t-$(SYMLINK) \"$(TARGET)\" \"" + dst_link + "\"";
                     if(!uninst.isEmpty())
                         uninst.append("\n\t");
                     uninst.append("-$(DEL_FILE) \"" + dst_link + "\"");
--- origsrc/qt-x11-opensource-src-4.4.0/qmake/generators/unix/unixmake2.cpp	2008-04-28 08:11:14.000000000 -0500
+++ src/qt-x11-opensource-src-4.4.0/qmake/generators/unix/unixmake2.cpp	2008-07-13 14:15:37.140625000 -0500
@@ -546,6 +546,14 @@
             if(!project->isEmpty("QMAKE_POST_LINK"))
                 t << "\n\t" << var("QMAKE_POST_LINK");
             t << endl << endl;
+        } else if(!project->isEmpty("QMAKE_CYGWIN_SHLIB")) {
+            t << "\n\t"
+              << "-$(DEL_FILE) $(TARGET) $(TARGET0)" << "\n\t"
+              << var("QMAKE_LINK_SHLIB_CMD") << "\n\t";
+            if(!destdir.isEmpty())
+              t  << "-$(DEL_FILE) " << destdir << "$(TARGET)\n\t"
+                 << "-$(DEL_FILE) " << destdir << "$(TARGET0)\n\t"
+                 << "-$(MOVE) $(TARGET) $(TARGET0) " << destdir;
         } else if(project->isEmpty("QMAKE_HPUX_SHLIB")) {
             t << "\n\t"
               << "-$(DEL_FILE) $(TARGET) $(TARGET0) $(TARGET1) $(TARGET2)" << "\n\t"
@@ -865,6 +873,10 @@
         t << "\t-$(LIBTOOL) --mode=clean $(DEL_FILE) " << "$(TARGET)" << endl;
     } else if(!project->isActiveConfig("staticlib") && project->values("QMAKE_APP_FLAG").isEmpty() &&
        !project->isActiveConfig("plugin")) {
+       if (!project->isEmpty("QMAKE_CYGWIN_SHLIB"))
+        t << "\t-$(DEL_FILE) " << destdir << "$(TARGET)" << " " << endl
+          << "\t-S(DEL_FILE) " << destdir << "$(TARGET0)" << endl;
+       else
         t << "\t-$(DEL_FILE) " << destdir << "$(TARGET)" << " " << endl
           << "\t-$(DEL_FILE) " << destdir << "$(TARGET0) " << destdir << "$(TARGET1) "
           << destdir << "$(TARGET2) $(TARGETA)" << endl;
@@ -979,8 +991,8 @@
         }
         if(!project->isEmpty("TARGET"))
             project->values("TARGET").first().prepend(project->first("DESTDIR"));
-       if (!project->values("QMAKE_CYGWIN_EXE").isEmpty())
-            project->values("TARGET_EXT").append(".exe");
+        if(!project->isEmpty("QMAKE_CYGWIN_EXE"))
+            project->values("TARGET").first() += ".exe";
     } else if (project->isActiveConfig("staticlib")) {
         project->values("TARGET").first().prepend("lib");
         project->values("TARGET").first() += ".a";
@@ -988,9 +1000,12 @@
             project->values("QMAKE_AR_CMD").append("$(AR) $(TARGET) $(OBJECTS)");
     } else {
         project->values("TARGETA").append(project->first("DESTDIR") + "lib" + project->first("TARGET") + ".a");
-        if(project->isActiveConfig("compile_libtool"))
-            project->values("TARGET_la") = QStringList(project->first("DESTDIR") + "lib" + project->first("TARGET") + Option::libtool_ext);
-
+        if(project->isActiveConfig("compile_libtool")) {
+             if (!project->isEmpty("QMAKE_CYGWIN_SHLIB"))
+                 project->values("TARGET_la") = QStringList(project->first("DESTDIR") + "lib" + project->first("L_TARGET") + Option::libtool_ext);
+             else
+                 project->values("TARGET_la") = QStringList(project->first("DESTDIR") + "lib" + project->first("TARGET") + Option::libtool_ext);
+        }
         if (!project->values("QMAKE_AR_CMD").isEmpty())
             project->values("QMAKE_AR_CMD").first().replace("(TARGET)","(TARGETA)");
         else
@@ -1011,8 +1026,12 @@
                                                       bundle_loc + unescapeFilePath(project->first("TARGET")));
         } else if(project->isActiveConfig("plugin")) {
             QString prefix;
-            if(!project->isActiveConfig("no_plugin_name_prefix"))
-                prefix = "lib";
+            if(!project->isActiveConfig("no_plugin_name_prefix")) {
+                if(!project->isEmpty("QMAKE_CYGWIN_SHLIB"))
+                    prefix = "cyg";
+                else
+                    prefix = "lib";
+            }
             project->values("TARGET_x.y.z").append(prefix +
                                                         project->first("TARGET") + "." +
                                                         project->first("QMAKE_EXTENSION_PLUGIN"));
@@ -1025,6 +1044,14 @@
                                                         project->first("QMAKE_EXTENSION_PLUGIN") +
                                                         "." + project->first("VER_MAJ"));
             project->values("TARGET") = project->values("TARGET_x.y.z");
+        } else if (!project->isEmpty("QMAKE_CYGWIN_SHLIB")) {
+            project->values("TARGET_").append("lib" + project->first("TARGET") + "." +
+                                                    project->first("QMAKE_EXTENSION_SHLIB") + ".a");
+            project->values("TARGET_x").append("cyg" + project->first("TARGET") + "-" +
+                                                    project->first("VER_MAJ") + "." + project->first("QMAKE_EXTENSION_SHLIB"));
+            project->values("L_TARGET").append("lib" + project->first("TARGET") + "." +
+                                                    project->first("QMAKE_EXTENSION_SHLIB"));
+            project->values("TARGET") = project->values("TARGET_x");
         } else if (!project->isEmpty("QMAKE_HPUX_SHLIB")) {
             project->values("TARGET_").append("lib" + project->first("TARGET") + ".sl");
             if(project->isActiveConfig("lib_version_first"))
@@ -1143,6 +1170,8 @@
                 project->values("QMAKE_LFLAGS") += project->values("QMAKE_LFLAGS_SONAME");
         } else {
             project->values("QMAKE_LFLAGS") += project->values("QMAKE_LFLAGS_SHLIB");
+            if(!project->isEmpty("QMAKE_CYGWIN_SHLIB"))
+                project->values("QMAKE_LFLAGS") += QString("-Wl,--out-implib,$(TARGET0)");
             if(!project->isEmpty("QMAKE_LFLAGS_COMPAT_VERSION")) {
                 if(project->isEmpty("COMPAT_VERSION"))
                     project->values("QMAKE_LFLAGS") += QString(project->first("QMAKE_LFLAGS_COMPAT_VERSION") +
@@ -1204,7 +1233,11 @@
 QString
 UnixMakefileGenerator::libtoolFileName(bool fixify)
 {
-    QString ret = var("TARGET");
+    QString ret;
+    if (!project->isEmpty("QMAKE_CYGWIN_SHLIB"))
+        ret = var("L_TARGET");
+    else
+        ret = var("TARGET");
     int slsh = ret.lastIndexOf(Option::dir_sep);
     if(slsh != -1)
         ret = ret.right(ret.length() - slsh - 1);
@@ -1250,9 +1283,14 @@
     if(project->isActiveConfig("plugin")) {
         t << var("TARGET");
     } else {
-        if (project->isEmpty("QMAKE_HPUX_SHLIB"))
-            t << var("TARGET_x.y.z") << " ";
-        t << var("TARGET_x") << " " << var("TARGET_");
+        if (!project->isEmpty("QMAKE_CYGWIN_SHLIB")) {
+            t << var("TARGET_");
+        } else {
+            if (project->isEmpty("QMAKE_HPUX_SHLIB")) {
+                t << var("TARGET_x.y.z") << " ";
+            }
+            t << var("TARGET_x") << " " << var("TARGET_");
+        }
     }
     t << "'\n\n";
 
@@ -1297,7 +1335,11 @@
 QString
 UnixMakefileGenerator::pkgConfigFileName(bool fixify)
 {
-    QString ret = var("TARGET");
+    QString ret;
+    if (!project->isEmpty("QMAKE_CYGWIN_SHLIB"))
+        ret = var("L_TARGET");
+    else
+        ret = var("TARGET");
     int slsh = ret.lastIndexOf(Option::dir_sep);
     if(slsh != -1)
         ret = ret.right(ret.length() - slsh - 1);
